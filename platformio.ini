; PlatformIO Project Configuration File
;
;   Build options: build flags, source filter
;   Upload options: custom upload port, speed and extra flags
;   Library options: dependencies, extra library storages
;   Advanced options: extra scripting
;
; Please visit documentation for the other options and examples
; https://docs.platformio.org/page/projectconf.html

[env:airm2m_core_esp32c3]
platform = espressif32
board = airm2m_core_esp32c3
framework = arduino
monitor_speed = 115200
lib_deps = 
    ESP32Async/ESPAsyncWebServer
    ESP32Async/AsyncTCP
    ArduinoJson
board_build.filesystem = littlefs
; ; OTA无线上传环境配置
[env:airm2m_core_esp32c3_ota]
platform = espressif32
board = airm2m_core_esp32c3
framework = arduino
monitor_speed = 115200
lib_deps = 
    ESP32Async/ESPAsyncWebServer
    ESP32Async/AsyncTCP
    ArduinoJson
board_build.filesystem = littlefs

; OTA无线上传配置
upload_protocol = espota
upload_port = trackcaresp32.local    ; 使用统一的主机名
; upload_port = 192.168.0.107         ; 备用：直接IP地址
upload_flags = 
    --port=3232
    --timeout=60                      ; 增加超时时间
    --auth=                           ; 如果设置了密码，在这里填写
    --debug                           ; 启用调试输出

; 构建标志
build_flags = 
    -DCORE_DEBUG_LEVEL=3             ; 启用调试级别
    -DARDUINO_USB_CDC_ON_BOOT=1      ; ESP32-C3 USB CDC支持


; ========================================
; 使用说明:
; 1. 首次上传使用: pio run -e airm2m_core_esp32c3 -t upload
; 2. 后续OTA更新使用: pio run -e airm2m_core_esp32c3_ota -t upload  
; 3. OTA调试版本: pio run -e airm2m_core_esp32c3_ota_debug -t upload
; 4. 或者在VS Code中选择对应的环境进行上传
; 5. 确保ESP32和电脑在同一WiFi网络中
; 6. 检查mDNS是否工作: ping trackcaresp32.local
; 
; 故障排除:
; - 如果OTA失败，先尝试ping ESP32的IP地址
; - 检查防火墙是否阻止了3232端口
; - 确认WiFi信号强度良好（>-70dBm）
; - 如果mDNS不工作，在upload_port中使用实际IP地址
; - 重启路由器和ESP32设备
; ========================================

; OTA调试专用环境 - 更详细的调试信息
; [env:airm2m_core_esp32c3_ota_debug]
; platform = espressif32
; board = airm2m_core_esp32c3
; framework = arduino
; monitor_speed = 115200
; lib_deps = 
;     ESP32Async/ESPAsyncWebServer
;     ESP32Async/AsyncTCP
;     ArduinoJson
; board_build.filesystem = littlefs

; ; OTA无线上传配置 - 调试版本
; upload_protocol = espota
; upload_port = ESP32-TrackCar.local
; upload_flags = 
;     --port=3232
;     --timeout=120                     ; 更长的超时时间
;     --auth=                           ; 密码留空
;     --debug                           ; 详细调试输出
;     --verbose                         ; 详细模式

; ; 调试构建标志
; build_flags = 
;     -DCORE_DEBUG_LEVEL=5             ; 最高调试级别
;     -DARDUINO_USB_CDC_ON_BOOT=1      ; ESP32-C3 USB CDC支持
;     -DOTA_DEBUG=1                    ; 自定义OTA调试标志

; ; 监控配置
; monitor_flags = 
;     --quiet
;     --echo
;     --eol=LF


