# 分段转向实现说明

## 功能概述
实现了智能追踪车的分段转向功能，每转15度停下来重新检测目标位置，确保追踪的精确性和稳定性。

## 实现特点

### 1. 分段转向逻辑
- **分段角度**: 每次转向15度
- **转向速度**: 每度10毫秒的转向时间
- **检测暂停**: 每段转向后暂停500毫秒重新检测

### 2. 状态管理
```cpp
static bool isTurning = false;              // 是否正在转向
static bool isPausingForDetection = false;  // 是否正在暂停检测
static double remainingAngle = 0;           // 剩余需要转向的角度
static int turnDirection = 0;               // 转向方向 (1=右, -1=左, 0=停止)
```

### 3. 工作流程

#### 阶段1: 转向决策
- 当目标角度超过30度阈值时，启动分段转向
- 计算总转向角度和转向方向
- 开始第一个15度段的转向

#### 阶段2: 段转向执行
- 每段最多转向15度
- 根据角度计算转向时间 (角度 × 10ms/度)
- 执行相应的电机转向指令

#### 阶段3: 检测暂停
- 每段转向完成后停止电机
- 暂停500ms进行重新检测
- 重置数据收集缓冲区获取新的目标位置

#### 阶段4: 继续或完成
- 如果剩余角度 > 5度，继续下一段转向
- 如果角度足够小或目标已居中，结束转向序列

### 4. 安全机制

#### 数据稳定性检查
- 收集5个样本的角度和距离数据
- 计算平均值和标准差进行滤波
- 只有数据稳定时才执行转向动作

#### 目标丢失处理
- 2秒等待期：停止运动等待目标重现
- 20秒搜索期：左右转动寻找目标  
- 超时保护：停止自动追踪避免无限搜索

#### 运动控制优先级
1. 转向暂停检测期间：强制停止所有运动
2. 转向执行期间：禁止距离控制
3. 正常追踪期间：同时进行角度和距离控制

### 5. 调试输出
提供详细的状态信息：
```
Starting segmented turn: total_angle=45.2°, direction=RIGHT
Turning segment: 15.0° for 150ms
Segment completed, remaining angle: 30.2°, pausing for detection
Pausing for detection... 250ms/500ms
Detection pause complete, continuing turn: remaining=30.2°
Segmented turn sequence completed
```

## 参数配置

### 可调参数
```cpp
const double SEGMENT_ANGLE = 15.0;              // 每段转向角度
const unsigned long TURN_TIME_PER_DEGREE = 10; // 每度转向时间(ms)
const unsigned long DETECTION_PAUSE_TIME = 500; // 检测暂停时间(ms)
const double ANGLE_THRESHOLD = 30.0;            // 开始转向的角度阈值
```

### 数据滤波参数
```cpp
const int MIN_DATA_COUNT = 3;                   // 最少数据样本数
const double MAX_ANGLE_STD_DEV = 5.0;           // 角度标准差阈值
const double MAX_DISTANCE_STD_DEV = 0.2;        // 距离标准差阈值
```

## 优势

1. **精确追踪**: 分段检测确保每次转向都基于最新的目标位置
2. **稳定性**: 多样本数据滤波避免噪声干扰
3. **可控性**: 小角度增量转向避免过度转向
4. **安全性**: 完善的状态管理和异常处理
5. **可调性**: 关键参数可根据实际情况调整

## 测试建议

1. **静态目标测试**: 使用固定目标测试转向精度
2. **动态目标测试**: 移动目标测试追踪响应性  
3. **边界条件测试**: 测试目标丢失和重现的处理
4. **角度精度测试**: 验证15度分段的实际转向角度
5. **性能测试**: 监控整个追踪循环的响应时间

## 已知限制

1. 转向时间基于经验值，可能需要根据实际电机特性调整
2. 分段角度固定为15度，大角度转向可能较慢
3. 暂停检测时间固定，可能需要根据雷达响应速度调整

## 后续优化方向

1. 基于实际转向结果的自适应时间调整
2. 动态分段角度：远距离大角度，近距离小角度
3. 预测性转向：基于目标运动趋势预测转向角度
4. 并行检测：转向过程中持续收集雷达数据
